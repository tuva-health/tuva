version: 2

models:

## Final
  - name: quality_measures__hedis_cql_engine_log
    description: |
      Final model with deduplicated CQL computations produced from external 
      source for HEDIS Digital Quality Measures (dQM).
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: hedis_cql_engine_log
      tags:
        - hedis
        - quality_measures
      materialized: table

  - name: quality_measures__hedis_summary_long
    description: |
      Final model with deduplicated quality measure results from external 
      source for HEDIS Digital Quality Measures (dQM).
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: hedis_summary_long
      tags:
        - hedis
        - quality_measures
      materialized: table

## Intermediate
  - name: quality_measures__int_hedis_cql_engine_log
    description: | 
      Intermediate model transforming CQL computations produced from external 
      source for HEDIS Digital Quality Measures (dQM). Adds row number to sort 
      rows from previous executions for the same measure, year, patient, and key.
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_hedis_cql_engine_log
      tags:
        - hedis
        - quality_measures
      materialized: table

  - name: quality_measures__int_hedis_measure_report
    description: |
      Intermediate model transforming quality measure report data from external 
      source for HEDIS Digital Quality Measures (dQM). Adds row number to sort 
      rows from previous executions for the same measure and patient.
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_hedis_measure_report
      tags:
        - hedis
        - quality_measures
      materialized: table

## Staging
  - name: quality_measures__stg_hedis_cql_engine_log
    description: | 
      Optional mart input. This table contains a detailed log of computations 
      of the CQL produced from external source for HEDIS Digital Quality 
      Measures (dQM).
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_hedis_cql_engine_log
      tags:
        - hedis
        - quality_measures
      materialized: view
      columns:
        - name: measure
        - name: measure_year
        - name: patient
        - name: cql_key
        - name: cql_value
        - name: data_source
        - name: file_name
        - name: file_date

  - name: quality_measures__stg_hedis_measure_report
    description: |
      Optional mart input. This table contains quality measure report data from 
      HEDIS Digital Quality Measures (dQM).
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_hedis_measure_report
      tags:
        - hedis
        - quality_measures
      materialized: view
      columns:
        - name: id
        - name: measure
        - name: status
        - name: type
        - name: period_start
        - name: period_end
        - name: patient
        - name: rate_1_id
        - name: rate_1_population_type_0
        - name: rate_1_population_count_0
        - name: rate_1_population_type_1
        - name: rate_1_population_count_1
        - name: rate_1_population_type_2
        - name: rate_1_population_count_2
        - name: rate_1_population_type_3
        - name: rate_1_population_count_3
        - name: rate_1_population_type_4
        - name: rate_1_population_count_4
        - name: rate_1_population_type_5
        - name: rate_1_population_count_5
        - name: rate_1_population_type_6
        - name: rate_1_population_count_6
        - name: rate_2_id
        - name: rate_2_population_type_0
        - name: rate_2_population_count_0
        - name: rate_2_population_type_1
        - name: rate_2_population_count_1
        - name: rate_2_population_type_2
        - name: rate_2_population_count_2
        - name: rate_2_population_type_3
        - name: rate_2_population_count_3
        - name: rate_2_population_type_4
        - name: rate_2_population_count_4
        - name: rate_2_population_type_5
        - name: rate_2_population_count_5
        - name: rate_2_population_type_6
        - name: rate_2_population_count_6
        - name: data_source
        - name: file_name
        - name: file_date
