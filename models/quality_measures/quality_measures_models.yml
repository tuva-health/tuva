version: 2

models:
## Final
  - name: quality_measures__summary_counts
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: summary_counts
      tags: quality_measures
      materialized: table
    description: Reporting measure counts with performance rates.
    columns:
      - name: measure_id
        description: Unique measure identification number.
        meta:
          terminology: https://thetuvaproject.com/value-sets/quality-measures#measures
      - name: measure_name
        description: Name of the measure.
        meta:
          terminology: https://thetuvaproject.com/value-sets/quality-measures#measures
      - name: measure_version
        description: Version of the measure.
        meta:
          terminology: https://thetuvaproject.com/value-sets/quality-measures#measures
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: denominator_sum
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: numerator_sum
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved with exclusion logic applied.
      - name: exclusion_sum
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: performance_rate
        description: >
          Calculated performance rate. The numerator sum divided by the 
          denominator sum after exclusion logic applied and multiplied by 100.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__summary_long
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: summary_long
      tags: quality_measures
      materialized: table
    description: >
      Long view of the results for the reporting version of all measures.
      Each row represents the results a measure per patient. A null for the  denominator
      indicates that the patient was not eligible for that measure.
    tests:
      - the_tuva_project.expect_table_row_count_to_be_between:
          description: This is a check in one of the final downstream marts to see if quality_measures__summary_long is populated. If this is flagging, please check other areas further upstream on the input layer.
          tags: ['tuva_dqi_sev_3', 'dqi', 'dqi_quality_measures', 'dqi_usability']
          min_value: 1
          strictly: false
          config:
            severity: warn
            enabled: "{{ (var('enable_input_layer_testing',
              true)) | as_bool }}"
            meta:
              dqi_test_description: "This is a check in one of the final downstream
                marts to see if quality_measures__summary_long is populated. If this
                is flagging, please check other areas further upstream on the input
                layer."
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: performance_flag
        description: >
          Performance flag calculated by using exclusion, numerator, and 
          denominator flags. When excluded from a measure the flag is null.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
        meta:
          terminology: https://thetuvaproject.com/value-sets/quality-measures#measures
      - name: measure_name
        description: Name of the measure.
        meta:
          terminology: https://thetuvaproject.com/value-sets/quality-measures#measures
      - name: measure_version
        description: Version of the measure.
        meta:
          terminology: https://thetuvaproject.com/value-sets/quality-measures#measures
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__summary_wide
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: summary_wide
      tags: quality_measures
      materialized: table
    description: >
      Wide view of the results for the reporting version of all measures.
      This model pivots measures on the patient level (i.e. one row per patient
      with flags for each measure. The false flags can be treated as care gaps
      as exclusions have been included in the pivot logic.
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: cqm_438
        description: >
          Performance flag for CQM438, Statin Therapy for the Prevention and 
          Treatment of Cardiovascular Disease. A null indicates that the 
          measure was not applicable for the patient.
      - name: cqm_130
        description: >
          Performance flag for CQM130, Documentation of Current Medications in the Medical Record. 
          A null indicates that the measure was not applicable for the patient.
      - name: nqf_0420
        description: >
          Performance flag for NQF0420, Pain Assessment and Follow-Up. 
          A null indicates that the measure was not applicable for the patient.
      - name: adh_diabetes
        description: >
          Performance flag for ADH-Diabetes, Medication Adherence for Diabetes Medications. 
          A null indicates that the measure was not applicable for the patient.
      - name: adh_ras
        description: >
          Performance flag for ADH-RAS, Medication Adherence for Hypertension. 
          A null indicates that the measure was not applicable for the patient.
      - name: supd
        description: >
          Performance flag for SUPD, Statin Use in Persons with Diabetes.
          A null indicates that the measure was not applicable for the patient.
      - name: adh_statins
        description: >
          Performance flag for ADH-Statins, Medication Adherence for Cholesterol. 
          A null indicates that the measure was not applicable for the patient.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

## Shared Exclusions
  - name: quality_measures__int_shared_exclusions_frailty
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_shared_exclusions_frailty
      tags: quality_measures
      materialized: table
    description: >
      Exclusion logic for patients with frailty used by other exclusion models.

  - name: quality_measures__int_shared_exclusions_advanced_illness
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_shared_exclusions_advanced_illness
      tags: quality_measures
      materialized: table
    description: >
      Exclusion logic for patients with frailty and advanced illness for entire patient population.

  - name: quality_measures__int_shared_exclusions_dementia
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_shared_exclusions_dementia
      tags: quality_measures
      materialized: table
    description: >
      Exclusion logic for patients with frailty and taking dementia medications for entire patient population.

  - name: quality_measures__int_shared_exclusions_hospice_palliative
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_shared_exclusions_hospice_palliative
      tags: quality_measures
      materialized: table
    description: >
      Exclusion logic for patients using hospice or palliative services for the reporting for entire patient population.

  - name: quality_measures__int_shared_exclusions_institutional_snp
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_shared_exclusions_institutional_snp
      tags: quality_measures
      materialized: table
    description: >
      Exclusion logic for patients staying in an institution for the reporting for entire patient population. 

## Intermediate

### Statin Therapy for the Prevention and Treatment of Cardiovascular Disease
  - name: quality_measures__int_cqm438__performance_period
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm438__performance_period
      tags: quality_measures
      materialized: view
    description: >
      Performance Period definition for Statin Therapy for the Prevention and Treatment of Cardiovascular Disease

  - name: quality_measures__int_cqm438_denominator_criteria1
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm438_denominator_criteria1
      tags: quality_measures
      materialized: table
    description: >
      Subset of denominator logic for submission of criteria 1 of the reporting version of Statin Therapy for the Prevention and Treatment of Cardiovascular Disease
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_cqm438_denominator_criteria2
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm438_denominator_criteria2
      tags: quality_measures
      materialized: table
    description: >
      Subset of denominator logic for submission of criteria 2 of the reporting version of Statin Therapy for the Prevention and Treatment of Cardiovascular Disease
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_cqm438_denominator_criteria3
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm438_denominator_criteria3
      tags: quality_measures
      materialized: table
    description: >
      Subset of denominator logic for submission of criteria 3 of the reporting version of Statin Therapy for the Prevention and Treatment of Cardiovascular Disease
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_cqm438_denominator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm438_denominator
      tags: quality_measures
      materialized: table
    description: >
      Denominator logic for submission of the reporting version of Statin Therapy for the Prevention and Treatment of Cardiovascular Disease
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: age
        description: Patient's age as of performance_period_begin date.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_cqm438_exclusions
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm438_exclusions
      tags: quality_measures
      materialized: table
    description: >
      Combined exclusion logic for the reporting version of CQM 438, Statin Therapy for the Prevention and Treatment of Cardiovascular Disease.
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_cqm438_long
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm438_long
      tags: quality_measures
      materialized: table
    description: >
      Final preparation of the reporting version of CQM 438, Statin Therapy for the Prevention and Treatment of Cardiovascular Disease before combining with other measures.
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_cqm438_numerator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm438_numerator
      tags: quality_measures
      materialized: table
    description: >
      Numerator logic for the reporting version of CQM 438, Statin Therapy for the Prevention and Treatment of Cardiovascular Disease
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

### Documentation of Current Medications in the Medical Record        
  - name: quality_measures__int_cqm130__performance_period
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm130__performance_period
      tags: quality_measures
      materialized: view
    description: >
      Performance Period definition for Documentation of Current Medications in the Medical Record.

  - name: quality_measures__int_cqm130_denominator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm130_denominator
      tags: quality_measures
      materialized: table
    description: >
      Denominator logic for the reporting version of Documentation of Current Medications in the Medical Record.
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: age
        description: Patient's age during latest encounter in the performance period.
      - name: procedure_encounter_date
        description: Patient's date of encounter in the performance period for procedures.
      - name: claims_encounter_date
        description: Patient's date of encounter in the performance period for medical claims.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_cqm130_exclusions
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm130_exclusions
      tags: quality_measures
      materialized: table
    description: >
      Combined exclusion logic for the reporting version of CQM 130, Documentation of Current Medications in the Medical Record.
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_cqm130_long
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm130_long
      tags: quality_measures
      materialized: table
    description: >
      Final preparation of the reporting version of CQM 130, Documentation of Current Medications in the Medical Record before combining with other measures.
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_cqm130_numerator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm130_numerator
      tags: quality_measures
      materialized: table
    description: >
      Numerator logic for the reporting version of CQM 130, Documentation of Current Medications in the Medical Record.
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

### Pain Assessment and Follow-Up
  - name: quality_measures__int_nqf0420__performance_period
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0420__performance_period
      tags: quality_measures
      materialized: view
    description: >
      Performance Period definition for Pain Assessment and Follow-Up.

  - name: quality_measures__int_nqf0420_denominator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0420_denominator
      tags: quality_measures
      materialized: table
    description: >
      Denominator logic for the reporting version of NQF 0420, Pain Assessment and Follow-Up.
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: age
        description: Patient's age during latest encounter in the performance period.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_nqf0420_exclusions
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0420_exclusions
      tags: quality_measures
      materialized: table
    description: >
      Combined exclusion logic for the reporting version of NQF 0420, Pain Assessment and Follow-Up.
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_nqf0420_long
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0420_long
      tags: quality_measures
      materialized: table
    description: >
      Final preparation of the reporting version of NQF 0420, Pain Assessment and Follow-Up before combining with other measures.
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_nqf0420_numerator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0420_numerator
      tags: quality_measures
      materialized: table
    description: >
      Numerator logic for the reporting version of NQF 0420, Pain Assessment and Follow-Up.
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

### Medication Adherence for Diabetes Medications
  - name: quality_measures__int_adh_diabetes__performance_period
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_adh_diabetes__performance_period
      tags: quality_measures
      materialized: view
    description: >
      Performance Period definition for Medication Adherence for Diabetes Medications.

  - name: quality_measures__int_adh_diabetes_denominator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_adh_diabetes_denominator
      tags: quality_measures
      materialized: table
    description: >
      Denominator logic for the reporting version of ADH-Diabetes, Medication Adherence for Diabetes Medications.
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: age
        description: Patient's age during latest encounter in the performance period.
      - name: dispensing_date
        description: Date the prescription was filled.
      - name: ndc_code
        description: National drug code on the claim.
      - name: days_supply
        description: Number of days the filled medication lasts for.
      - name: days_in_treatment_period
        description: Number of days from first dispensing_date to performance_period_end in the performance or measurement period.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_adh_diabetes_exclusions
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_adh_diabetes_exclusions
      tags: quality_measures
      materialized: table
    description: >
      Combined exclusion logic for the reporting version of ADH-Diabetes, Medication Adherence for Diabetes Medications.
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_adh_diabetes_long
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_adh_diabetes_long
      tags: quality_measures
      materialized: table
    description: >
      Final preparation of the reporting version of ADH-Diabetes, Medication Adherence for Diabetes Medications before combining with other measures.
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_adh_diabetes_numerator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_adh_diabetes_numerator
      tags: quality_measures
      materialized: table
    description: >
      Numerator logic for the reporting version of ADH-Diabetes, Medication Adherence for Diabetes Medications.
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: adherence
        description: >
          The degree to which the person behaviour corresponds with taking a medicine optimally in percentage.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

### Medication Adherence for Hypertension
  - name: quality_measures__int_adhras__performance_period
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_adhras__performance_period
      tags: quality_measures
      materialized: view
    description: >
      Performance Period definition for Medication Adherence for Hypertension

  - name: quality_measures__int_adhras_denominator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_adhras_denominator
      tags: quality_measures
      materialized: table
    description: >
      Denominator logic for the reporting version of ADH-RAS, Medication Adherence for Hypertension
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: dispensing_date
        description: Date the prescription was filled.
      - name: first_dispensing_date
        description: Date the first prescription was filled.
      - name: days_supply
        description: Number of days supply.
      - name: ndc_code
        description: National drug code on the claim.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_adhras_exclusions
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_adhras_exclusions
      tags: quality_measures
      materialized: table
    description: >
      Combined exclusion logic for the reporting version of ADH-RAS, Medication Adherence for Hypertension
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_adhras_long
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_adhras_long
      tags: quality_measures
      materialized: table
    description: >
      Final preparation of the reporting version of ADH-RAS, Medication Adherence for Hypertension before combining with other measures.
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_adhras_numerator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_adhras_numerator
      tags: quality_measures
      materialized: table
    description: >
      Numerator logic for the reporting version of ADH-RAS, Medication Adherence for Hypertension
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: adherence
        description: >
          The extent to which a person's behaviour corresponds with taking a medicine optimally.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

### Statin Use in Persons with Diabetes
  - name: quality_measures__int_supd__performance_period
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_supd__performance_period
      tags: quality_measures
      materialized: view
    description: >
      Performance Period definition for Statin Use in Persons with Diabetes

  - name: quality_measures__int_supd_denominator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_supd_denominator
      tags: quality_measures
      materialized: table
    description: >
      Denominator logic for the reporting version of SUPD, Statin Use in Persons with Diabetes
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: age
        description: Patient's age as of the performance_period_begin date.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_supd_exclusions
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_supd_exclusions
      tags: quality_measures
      materialized: table
    description: >
      Combined exclusion logic for the reporting version of SUPD, Statin Use in Persons with Diabetes
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_supd_long
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_supd_long
      tags: quality_measures
      materialized: table
    description: >
      Final preparation of the reporting version of SUPD, Statin Use in Persons with Diabetes before combining with other measures.
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_supd_numerator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_supd_numerator
      tags: quality_measures
      materialized: table
    description: >
      Numerator logic for the reporting version of SUPD, Statin Use in Persons with Diabetes
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

### Medication Adherence for Cholesterol
  - name: quality_measures__int_adh_statins__performance_period
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_adh_statins__performance_period
      tags: quality_measures
      materialized: view
    description: >
      Performance Period definition for Medication Adherence for Cholesterol

  - name: quality_measures__int_adh_statins_denominator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_adh_statins_denominator
      tags: quality_measures
      materialized: table
    description: >
      Denominator logic for the reporting version of ADH-Statins, Medication Adherence for Cholesterol
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: dispensing_date
        description: Date the prescription was filled.
      - name: first_dispensing_date
        description: Date the first prescription was filled.
      - name: days_supply
        description: Number of days supply.
      - name: ndc_code
        description: National drug code on the claim.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_adh_statins_exclusions
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_adh_statins_exclusions
      tags: quality_measures
      materialized: table
    description: >
      Combined exclusion logic for the reporting version of ADH-Statins, Medication Adherence for Cholesterol
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_adh_statins_long
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_adh_statins_long
      tags: quality_measures
      materialized: table
    description: >
      Final preparation of the reporting version of ADH-Statins, Medication Adherence for Cholesterol before combining with other measures.
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_adh_statins_numerator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_adh_statins_numerator
      tags: quality_measures
      materialized: table
    description: >
      Numerator logic for the reporting version of ADH-Statins, Medication Adherence for Cholesterol
    columns:
      - name: person_id
        description: Unique person_id for each person.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: adherence
        description: >
          The extent to which a person's behaviour corresponds with taking a medicine optimally.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

## Staging
  - name: quality_measures__stg_core__condition
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_condition
      tags: quality_measures
      materialized: view
    description: Staging conditions from core.
    columns:
      - name: person_id
        tests:
          - not_null:
              severity: warn
      - name: recorded_date
      - name: source_code_type
      - name: source_code
      - name: normalized_code_type
      - name: normalized_code
      - name: tuva_last_run

  - name: quality_measures__stg_core__encounter
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_encounter
      tags: quality_measures
      materialized: view
    description: >
      Staging encounters from core. Creates an empty table if using claims only.
    columns:
      - name: person_id
        tests:
          - not_null:
              severity: warn
      - name: encounter_type
      - name: encounter_start_date
      - name: encounter_end_date
      - name: tuva_last_run

  - name: quality_measures__stg_core__medication
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_medication
      tags: quality_measures
      materialized: view
    description: >
      Staging medications from core. Creates an empty table if using claims only.
    columns:
      - name: person_id
        tests:
          - not_null:
              severity: warn
      - name: encounter_id
      - name: prescribing_date
      - name: dispensing_date
      - name: ndc_code
      - name: rxnorm_code
      - name: tuva_last_run

  - name: quality_measures__stg_core__observation
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_observation
      tags: quality_measures
      materialized: view
    description: >
      Staging medications from core. Creates an empty table if using claims only.
    columns:
      - name: person_id
        tests:
          - not_null:
              severity: warn
      - name: observation_date
      - name: source_code_type
      - name: source_code
      - name: normalized_code_type
      - name: normalized_code
      - name: tuva_last_run

  - name: quality_measures__stg_core__patient
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_patient
      tags: quality_measures
      materialized: view
    description: Staging eligibility from the input layer.
    columns:
      - name: person_id
        tests:
          - not_null:
              severity: warn
      - name: sex
        tests:
          - not_null:
              severity: warn
          - accepted_values:
              values: ['female', 'male','unknown']
              severity: warn
      - name: birth_date
        tests:
          - not_null:
              severity: warn
      - name: death_date
      - name: tuva_last_run

  - name: quality_measures__stg_core__procedure
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_procedure
      tags: quality_measures
      materialized: view
    description: Staging procedures from core.
    columns:
      - name: person_id
        tests:
          - not_null:
              severity: warn
      - name: procedure_date
      - name: source_code_type
      - name: source_code
      - name: normalized_code_type
      - name: normalized_code
      - name: modifier_1
      - name: modifier_2
      - name: modifier_3
      - name: modifier_4
      - name: modifier_5
      - name: tuva_last_run

  - name: quality_measures__stg_medical_claim
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_medical_claim
      tags: quality_measures
      materialized: view
    description: >
      Staging medical claims from the input layer. Creates an empty table if 
      using clinical only.
    columns:
      - name: person_id
      - name: claim_start_date
      - name: claim_end_date
      - name: place_of_service
      - name: hcpcs_code
      - name: hcpcs_modifier_1
      - name: hcpcs_modifier_2
      - name: hcpcs_modifier_3
      - name: hcpcs_modifier_4
      - name: hcpcs_modifier_5
      - name: tuva_last_run

  - name: quality_measures__stg_pharmacy_claim
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_pharmacy_claim
      tags: quality_measures
      materialized: view
    description: >
      Staging pharmacy claims from the input layer. Creates an empty table if 
      using clinical only.
    columns:
      - name: person_id
      - name: dispensing_date
      - name: ndc_code
      - name: days_supply
      - name: paid_date
      - name: tuva_last_run


  - name: quality_measures__stg_core__lab_result
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_lab_result
      tags: quality_measures
      materialized: view
    description: >
      Staging lab results from the input layer. Creates an empty table if 
      using claims only.
    columns:
      - name: person_id
      - name: result
      - name: result_date
      - name: collection_date
      - name: code_type
      - name: code
