version: 2

models:
  - name: hcc_recapture__stg_coef_hier
    description: >
      Combine HCC hierarchy rankings with coefficients and add risk model code. Long-term risk model code should be added directly to the
      Tuva seed files instead.
    config:
      schema: hcc_recapture
      alias: stg_coef_hier
      tags: ["hcc_recapture", "staging"]
      materialized: table
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - model_version
            - hcc_code
            - hcc_hierarchy_group
            - hcc_hierarchy_group_rank
            - risk_model_code
    columns:
      - name: model_version
        description: >
          The CMS Medicare risk model version. This includes models such as v22,v24, and v28 which are documented in the 
          yearly rate announcement (e.g. https://www.cms.gov/files/document/2026-announcement.pdf) and on the CMS risk adjustment 
          website: https://www.cms.gov/medicare/payment/medicare-advantage-rates-statistics/risk-adjustment
      - name: hcc_code
        description: The hierarchical condition category code.      
      - name: hcc_hierarchy_group
        description: >
          The name of the HCC hierarchy group. Determined based off of the CMS risk adjustment website model software.
          For example, in 2025, the hierarchies were stored in a file called `V28115H1.txt`. The file will end in an H.
      - name: hcc_hierarchy_group_rank
        description: >
          The rank within the HCC hierarchy group. The lower the number, the higher the rank. When 2 HCCs within the same group are 
          coded within the same collection year, the HCC with the lower rank will be chosen of the two for a given beneficiary.
      - name: risk_model_code
        description: >
          There are different coefficients depending on a few factors such as dual eligibility, new enrollee, institutional status, etc...
          This column provides acronyms based off of the CMS risk adjustment SAS code. For example, these can be found in the `C2824T2N_25.csv` file for
          the 2025 CMS risk adjustment software.
  - name: hcc_recapture__stg_eligible_benes
    description: >
      Beneficiaries eligible for HCC recapture. When ESRD risk scores are available in the Tuva project, 
      the filter removing ESRD beneficiaries will need to be removed.
    config:
      schema: hcc_recapture
      alias: stg_eligible_benes
      tags: ["hcc_recapture", "staging"]
      materialized: table
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - person_id
            - collection_year
            - payer
    columns:
      - name: person_id
        description: A unique identifier for a person.
      - name: collection_year
        description: The year that the claims originated and were originally coded.
      - name: payer
        description: The name of the person (i.e. beneficiary) insurance provider.
