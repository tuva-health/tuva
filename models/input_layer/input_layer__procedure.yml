version: 2
models:
  - name: input_layer__procedure
    description: |
      The procedure table contains information on procedures that were performed on patients in the dataset.
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_input_layer{% else %}input_layer{%- endif -%}
      tags: input_layer
      materialized: view
    columns:
      - name: procedure_id
        description: The unique identifier for the performed procedure.
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
                - dqi_service_categories
                - dqi_ccsr
                - dqi_cms_chronic_conditions
                - dqi_tuva_chronic_conditions
                - dqi_cms_hccs
                - dqi_ed_classification
                - dqi_financial_pmpm
                - dqi_quality_measures
                - dqi_readmission
              config:
                severity: error
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - unique:
              tags:
                - tuva_dqi_sev_1
                - dqi
                - dqi_service_categories
                - dqi_ccsr
                - dqi_cms_chronic_conditions
                - dqi_tuva_chronic_conditions
                - dqi_cms_hccs
                - dqi_ed_classification
                - dqi_financial_pmpm
                - dqi_quality_measures
                - dqi_readmission
              config:
                severity: error
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - not_null:
              tags:
                - tuva_dqi_sev_1
                - dqi
                - dqi_service_categories
                - dqi_ccsr
                - dqi_cms_chronic_conditions
                - dqi_tuva_chronic_conditions
                - dqi_cms_hccs
                - dqi_ed_classification
                - dqi_financial_pmpm
                - dqi_quality_measures
                - dqi_readmission
              config:
                severity: error
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: varchar
          is_primary_key: true
      - name: person_id
        description: Unique identifier for each person in the dataset.
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
                - dqi_cms_chronic_conditions
                - dqi_quality_measures
                - dqi_readmission
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - not_null:
              tags:
                - tuva_dqi_sev_2
                - dqi
                - dqi_cms_chronic_conditions
                - dqi_quality_measures
                - dqi_readmission
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: varchar
      - name: patient_id
        description: Identifier that links a patient to a particular clinical source system.
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - the_tuva_project.warn_if_null_percentage_is_100:
              description: Percentage of values that are null.
              tags:
                - tuva_dqi_sev_5
                - dqi
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: varchar
      - name: encounter_id
        description: Unique identifier for each encounter in the dataset.
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
                - dqi_quality_measures
                - dqi_readmission
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - the_tuva_project.warn_if_null_percentage_is_100:
              description: Percentage of values that are null.
              tags:
                - tuva_dqi_sev_5
                - dqi
                - dqi_quality_measures
                - dqi_readmission
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: varchar
      - name: claim_id
        description: Unique identifier for a claim. Each claim represents a distinct healthcare service or set of services provided to a patient.
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - the_tuva_project.warn_if_null_percentage_is_100:
              description: Percentage of values that are null.
              tags:
                - tuva_dqi_sev_5
                - dqi
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: varchar
      - name: procedure_date
        description: Date when the procedure was performed.
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
                - dqi_cms_chronic_conditions
                - dqi_quality_measures
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - the_tuva_project.expect_column_values_to_be_of_type:
              column_type: date
              tags:
                - tuva_dqi_sev_2
                - dqi
                - dqi_cms_chronic_conditions
                - dqi_quality_measures
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - the_tuva_project.expect_column_values_to_be_between:
              tags:
                - tuva_dqi_sev_4
                - dqi
              min_value: '''1900-01-01'''
              max_value: '''2100-01-01'''
              strictly: false
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: date
      - name: source_code_type
        description: The type of code reported in the source system (e.g., ICD-10 code, NDC, lab, etc)
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
                - dqi_quality_measures
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - accepted_values:
              values:
                - snomed-ct
                - hcpcs
                - icd-10-pcs
                - icd-9-pcs
              tags:
                - tuva_dqi_sev_2
                - dqi
                - dqi_cms_hccs
                - dqi_quality_measures
              config:
                severity: warn
        meta:
          data_type: varchar
      - name: source_code
        description: The code in the source system (e.g., the ICD-10 code, NDC, lab, etc)
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
                - dqi_quality_measures
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - the_tuva_project.warn_if_null_percentage_is_100:
              description: Percentage of values that are null.
              tags:
                - tuva_dqi_sev_5
                - dqi
                - dqi_quality_measures
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: varchar
      - name: source_description
        description: Description of the source code in the source system.
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - the_tuva_project.warn_if_null_percentage_is_100:
              description: Percentage of values that are null.
              tags:
                - tuva_dqi_sev_5
                - dqi
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: varchar
      - name: normalized_code_type
        description: The normalized type of code.
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
                - dqi_cms_chronic_conditions
                - dqi_readmission
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - relationships:
              to: ref('reference_data__code_type')
              field: code_type
              tags:
                - tuva_dqi_sev_3
                - dqi
                - dqi_cms_chronic_conditions
                - dqi_readmission
              config:
                severity: warn
                enabled: '{{ ((target.type != ''bigquery'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
        meta:
          data_type: varchar
      - name: normalized_code
        description: The normalized code.
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
                - dqi_cms_chronic_conditions
                - dqi_readmission
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - the_tuva_project.warn_if_null_percentage_is_100:
              description: Percentage of values that are null.
              tags:
                - tuva_dqi_sev_5
                - dqi
                - dqi_cms_chronic_conditions
                - dqi_readmission
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: varchar
      - name: normalized_description
        description: Normalized description of the code.
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - the_tuva_project.warn_if_null_percentage_is_100:
              description: Percentage of values that are null.
              tags:
                - tuva_dqi_sev_5
                - dqi
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: varchar
      - name: modifier_1
        description: First modifier for the procedure code.
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
                - dqi_quality_measures
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - relationships:
              description: Procedure modifier should be a valid code set
              to: ref('terminology__hcpcs_level_2')
              field: hcpcs
              tags:
                - tuva_dqi_sev_4
                - dqi
                - dqi_quality_measures
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: varchar
      - name: modifier_2
        description: Second modifier for the procedure code.
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
                - dqi_quality_measures
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - relationships:
              description: Procedure modifier should be a valid code set
              to: ref('terminology__hcpcs_level_2')
              field: hcpcs
              tags:
                - tuva_dqi_sev_4
                - dqi
                - dqi_quality_measures
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: varchar
      - name: modifier_3
        description: Third modifier for the procedure code.
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
                - dqi_quality_measures
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - relationships:
              description: Procedure modifier should be a valid code set
              to: ref('terminology__hcpcs_level_2')
              field: hcpcs
              tags:
                - tuva_dqi_sev_4
                - dqi
                - dqi_quality_measures
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: varchar
      - name: modifier_4
        description: Fourth modifier for the procedure code.
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
                - dqi_quality_measures
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - relationships:
              description: Procedure modifier should be a valid code set
              to: ref('terminology__hcpcs_level_2')
              field: hcpcs
              tags:
                - tuva_dqi_sev_4
                - dqi
                - dqi_quality_measures
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: varchar
      - name: modifier_5
        description: Fifth modifier for the procedure code.
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
                - dqi_quality_measures
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - relationships:
              description: Procedure modifier should be a valid code set
              to: ref('terminology__hcpcs_level_2')
              field: hcpcs
              tags:
                - tuva_dqi_sev_4
                - dqi
                - dqi_quality_measures
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: varchar
      - name: practitioner_id
        description: Unique identifier for the practitioner on record (e.g., ordered medication, performed the procedure, etc).
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - the_tuva_project.warn_if_null_percentage_is_100:
              description: Percentage of values that are null.
              tags:
                - tuva_dqi_sev_5
                - dqi
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: varchar
      - name: data_source
        description: User-configured field that indicates the data source.
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
                - dqi_cms_chronic_conditions
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - the_tuva_project.warn_if_null_percentage_is_100:
              description: Percentage of values that are null.
              tags:
                - tuva_dqi_sev_5
                - dqi
                - dqi_cms_chronic_conditions
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: varchar
          is_primary_key: true
      - name: file_name
        description: The file name of the source file.
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: varchar
      - name: ingest_datetime
        description: The date and time the source file was ingested into the data warehouse or landed in cloud storage.
        tests:
          - the_tuva_project.expect_column_to_exist:
              tags:
                - tuva_dqi_sev_1
                - dqi
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
          - the_tuva_project.expect_column_values_to_be_in_type_list:
              column_type_list:
                - date
                - datetime
                - time
                - timestamp
                - timestamp_ntz
                - timestampntz
                - timestamp_ltz
                - timestampltz
                - timestamp_tz
                - timestamptz
                - timestamp with time zone
                - timestamp without time zone
                - datetime2
                - datetimeoffset
              tags:
                - tuva_dqi_sev_2
                - dqi
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
        meta:
          data_type: timestamp
