version: 2
models:
  - name: input_layer__appointment
    description: |
      The appointment table contains information related to appointments at a 
      healthcare facility. This table may include canceled, completed, 
      or scheduled appointments.
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_input_layer{% else %}input_layer{%- endif -%}
      tags: input_layer
      materialized: view
    columns:
      - name: appointment_id
        description: Unique identifier for the appointment.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: error
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
          - unique:
              config:
                severity: error
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
          - not_null:
              config:
                severity: error
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
            is_primary_key: true
      - name: person_id
        description: Unique identifier for each person in the dataset.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
          - not_null:
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
                tags:
                  - tuva_dqi_sev_2
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: patient_id
        description: Identifier that links a patient to a particular clinical source system.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
          - not_null:
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
                tags:
                  - tuva_dqi_sev_2
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: encounter_id
        description: Unique identifier for each encounter in the dataset.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: source_appointment_type_code
        description: Appointment type code from the source.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
          - not_null:
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
                tags:
                  - tuva_dqi_sev_2
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: source_appointment_type_description
        description: Appointment type description from the source.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
          - not_null:
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
                tags:
                  - tuva_dqi_sev_2
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: normalized_appointment_type_code
        description: Normalized appointment type code.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: normalized_appointment_type_description
        description: Normalized appointment type description.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: start_datetime
        description: The start date/time of the appointment or service.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
          - not_null:
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
                tags:
                  - tuva_dqi_sev_2
                  - dqi
                  - dqi_quality_measures
          - the_tuva_project.expect_column_values_to_be_in_type_list:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_2
                  - dqi
              arguments:
                column_type_list:
                  - date
                  - datetime
                  - time
                  - timestamp
                  - timestamp_ntz
                  - timestampntz
                  - timestamp_ltz
                  - timestampltz
                  - timestamp_tz
                  - timestamptz
                  - timestamp with time zone
                  - timestamp without time zone
                  - datetime2
                  - datetimeoffset
        config:
          meta:
            data_type: timestamp
      - name: end_datetime
        description: The end date/time of the appointment or service.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
          - the_tuva_project.expect_column_values_to_be_in_type_list:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_2
                  - dqi
              arguments:
                column_type_list:
                  - date
                  - datetime
                  - time
                  - timestamp
                  - timestamp_ntz
                  - timestampntz
                  - timestamp_ltz
                  - timestampltz
                  - timestamp_tz
                  - timestamptz
                  - timestamp with time zone
                  - timestamp without time zone
                  - datetime2
                  - datetimeoffset
        config:
          meta:
            data_type: timestamp
      - name: duration
        description: Number of minutes that the appointment or service is to take.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: number
      - name: location_id
        description: Unique identifier for each location.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: practitioner_id
        description: Unique identifier for the practitioner on record (e.g., ordered medication, performed the procedure, etc).
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: source_status
        description: Status of the appointment from the source system.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
          - not_null:
              config:
                severity: warn
                enabled: '{{ var(''enable_input_layer_testing'', true) | as_bool }}'
                tags:
                  - tuva_dqi_sev_2
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: normalized_status
        description: The normalized status of the appointment.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: appointment_specialty
        description: Specialty of a practitioner that would be required to perform the service requested in this appointment.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: reason
        description: Free text reason for the appointment or service.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: source_reason_code_type
        description: The type of code reported in the source system (e.g., ICD-10 code, NDC, lab, etc)
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
          - accepted_values:
              config:
                severity: warn
                tags:
                  - tuva_dqi_sev_2
                  - dqi
                  - dqi_quality_measures
              arguments:
                values:
                  - icd-10-cm
        config:
          meta:
            data_type: varchar
      - name: source_reason_code
        description: The code in the source system for the appointment reason (e.g., ICD-10 code).
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: source_reason_description
        description: Description of the source code for the appointment reason in the source system (e.g., ICD-10 description).
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: normalized_reason_code_type
        description: The normalized type of code.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
          - accepted_values:
              config:
                severity: warn
                tags:
                  - tuva_dqi_sev_2
                  - dqi
                  - dqi_quality_measures
              arguments:
                values:
                  - icd-10-cm
        config:
          meta:
            data_type: varchar
      - name: normalized_reason_code
        description: The normalized code for the appointment reason (e.g., ICD-10 code).
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: normalized_reason_description
        description: Normalized description of the code for the appointment reason (e.g., ICD-10 description).
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: cancellation_reason
        description: Free text reason why the appointment was cancelled.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: source_cancellation_reason_code_type
        description: The type of code reported in the source system (e.g., ICD-10 code, NDC, lab, etc)
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
          - accepted_values:
              config:
                severity: warn
                tags:
                  - tuva_dqi_sev_2
                  - dqi
                  - dqi_quality_measures
              arguments:
                values:
                  - appointment-cancellation-reason
        config:
          meta:
            data_type: varchar
      - name: source_cancellation_reason_code
        description: The code in the source system for the cancellation reason.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: source_cancellation_reason_description
        description: Description of the source code for the cancellation reason in the source system.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: normalized_cancellation_reason_code_type
        description: The normalized type of code.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
          - accepted_values:
              config:
                severity: warn
                tags:
                  - tuva_dqi_sev_2
                  - dqi
                  - dqi_quality_measures
              arguments:
                values:
                  - appointment-cancellation-reason
        config:
          meta:
            data_type: varchar
      - name: normalized_cancellation_reason_code
        description: The normalized code for the cancellation reason.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: normalized_cancellation_reason_description
        description: Normalized description of the code for the cancellation reason.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: data_source
        description: User-configured field that indicates the data source.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
            is_primary_key: true
      - name: file_name
        description: The file name of the source file.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
        config:
          meta:
            data_type: varchar
      - name: ingest_datetime
        description: The date and time the source file was ingested into the data warehouse or landed in cloud storage.
        tests:
          - the_tuva_project.expect_column_to_exist:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_1
                  - dqi
                  - dqi_quality_measures
          - the_tuva_project.expect_column_values_to_be_in_type_list:
              config:
                severity: warn
                enabled: '{{ ((target.type != ''fabric'') and var(''enable_input_layer_testing'', true)) | as_bool }}'
                tags:
                  - tuva_dqi_sev_2
                  - dqi
              arguments:
                column_type_list:
                  - date
                  - datetime
                  - time
                  - timestamp
                  - timestamp_ntz
                  - timestampntz
                  - timestamp_ltz
                  - timestampltz
                  - timestamp_tz
                  - timestamptz
                  - timestamp with time zone
                  - timestamp without time zone
                  - datetime2
                  - datetimeoffset
        config:
          meta:
            data_type: timestamp