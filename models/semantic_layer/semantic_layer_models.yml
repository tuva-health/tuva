version: 2

models:

- name: semantic_layer__dim_condition
  description: >
    Condition dimension table for use in analytic data models, includes surrogate key to link condition descriptions in a unified way.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: dim_condition
    tags: semantic_layer
    materialized: table

- name: semantic_layer__dim_data_source
  description: >
    Data source dimension table for use in analytic data models.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: dim_data_source
    tags: semantic_layer
    materialized: table

- name: semantic_layer__dim_date
  description: >
    Date dimension for use in analytic data models, provides all dates along with categorizations like year month, month, quarter, and year, day of week, etc.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: dim_date
    tags: semantic_layer
    materialized: table

- name: semantic_layer__dim_encounter_group
  description: >
    Unique encounter group dimension for use in analytic data models.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: dim_encounter_group
    tags: semantic_layer
    materialized: table
  columns:
  - name: encounter_group_sk
    description: SK for unique encounter groups
    tests:
    - unique:
        config:
          severity: error

- name: semantic_layer__dim_encounter_provider
  description: >
    Unique primary provider dimension for use in analytic data models.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: dim_encounter_provider
    tags: semantic_layer
    materialized: table
  columns:
  - name: encounter_id
    description: ID for unique encounters
    tests:
    - unique:
        config:
          severity: error

- name: semantic_layer__dim_encounter_type
  description: >
     Unique encounter type dimension for use in analytic data models.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: dim_encounter_type
    tags: semantic_layer
    materialized: table
  columns:
  - name: encounter_type_sk
    description: SK for unique encounter types
    tests:
    - unique:
        config:
          severity: error

- name: semantic_layer__dim_member_months
  description: >
    Member dimension information at the member month grain, can be joined via member_month_sk to most fact tables for member attributes that change over time.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: dim_member_months
    tags: semantic_layer
    materialized: table

- name: semantic_layer__dim_member
  description: >
    Member dimension for use in analytics data models, provides the current value of member attributes and attributes that do not change over time.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: dim_member
    tags: semantic_layer
    materialized: table
  columns:
  - name: person_sk
    description: Unique key of patient id and data source
    tests:
    - unique:
        config:
          severity: error

- name: semantic_layer__dim_service_category
  description: >
    Unique service categories dimension for use in analytic data models.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: dim_service_category
    tags: semantic_layer
    materialized: table
  columns:
  - name: service_category_sk
    description: SK for unique combination of service categories
    tests:
    - unique:
        config:
          severity: error

- name: semantic_layer__fact_admissions
  description: >
    Admission and readmissions classifications for all inpatient encounters.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: fact_admissions
    tags: semantic_layer
    materialized: table

- name: semantic_layer__fact_claims
  description: >
    Claim line level fact for use in Power BI data models.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: fact_claims
    tags: semantic_layer
    materialized: table
  columns:
  - name: medical_claim_id
    description: Unique claim line id
    tests:
    - unique:
        config:
          severity: error

- name: semantic_layer__fact_ed_visits
  description: >
    ED classifications for all ED encounters.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: fact_ed_visits
    tags: semantic_layer
    materialized: table

- name: semantic_layer__fact_encounter_service_bridge
  description: >
    Bridge table for encounters and service categories for use in Power BI data models.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: fact_encounter_service_bridge
    tags: semantic_layer
    materialized: table

- name: semantic_layer__fact_encounters
  description: >
    Encounter level fact for use in Power BI data models.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: fact_encounters
    tags: semantic_layer
    materialized: table
  columns:
  - name: encounter_id
    description: Unique encounter id
    tests:
    - unique:
        config:
          severity: error

- name: semantic_layer__fact_expected_values
  description: >
    Claims expected values fact table for use in Power BI data models.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: fact_expected_values
    tags: semantic_layer
    materialized: table

- name: semantic_layer__fact_hcc_gaps
  description: >
    HCC gaps for use in analytic data models.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: fact_hcc_gaps
    tags: semantic_layer
    materialized: table

- name: semantic_layer__fact_member_condition_bridge
  description: >
    Member to condition bridge table table for use in Power BI data models.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: fact_member_condition_bridge
    tags: semantic_layer
    materialized: table

- name: semantic_layer__fact_member_months
  description: >
    Member months fact for use in Power BI data models.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: fact_member_months
    tags: semantic_layer
    materialized: table
  data_tests:
  - dbt_utils.unique_combination_of_columns:
      combination_of_columns:
        - person_id
        - data_source
        - year_month
  columns:
  - name: patient_source_key
    description: Unique combination of patient id and data source

- name: semantic_layer__fact_quality_measures
  description: >
    Quality measure level fact for use in analytic data models.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: fact_quality_measures
    tags: semantic_layer
    materialized: table

- name: semantic_layer__fact_pharmacy_claims
  description: >
    HCC risk scores by patient, model version and payment year.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: fact_pharmacy_claims
    tags: semantic_layer
    materialized: table

- name: semantic_layer__fact_risk_factors
  description: >
    Risk factors included in risk score calculation with coefficients.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: fact_risk_factors
    tags: semantic_layer
    materialized: table

- name: semantic_layer__fact_risk_scores
  description: >
    HCC risk scores by patient, model version and payment year.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: fact_risk_scores
    tags: semantic_layer
    materialized: table

- name: semantic_layer__stg_ahrq_measures__pqi_summary
  description: Staging table for AHRQ PQI measure definitions.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_ahrq_measures__pqi_summary
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_chronic_conditions__tuva_chronic_conditions_long
  description: Staging table for Tuva chronic conditions long format.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_chronic_conditions__tuva_chronic_conditions_long
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_cms_hcc__patient_risk_factors
  description: Staging table for monthly patient risk factors.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_cms_hcc__patient_risk_factors
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_cms_hcc__patient_risk_scores_monthly
  description: Staging table for monthly patient risk scores from CMS HCC model.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_cms_hcc__patient_risk_scores_monthly
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_cms_hcc__patient_risk_scores
  description: Staging table for monthly patient risk scores from CMS HCC model.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_cms_hcc__patient_risk_scores
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_core__eligibility
  description: Staging table for core eligibility data.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_core__eligibility
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_core__encounter
  description: Staging table for monthly patient risk scores from CMS HCC model.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_core__encounter
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_core__medical_claim
  description: Staging table for core medical claim object.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_core__medical_claim
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_core__member_months
  description: Staging table for core member month object.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_core__member_months
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_core__patient
  description: Staging table for core patient object.
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_core__patient
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_core__pharmacy_claim
  description: Staging table for core pharmacy claim object
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_core__pharmacy_claim
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_core__practitioner
  description: Staging table for core practitioner object
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_core__practitioner
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_ed_classification__summary
  description: Staging table for ed classification object
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_ed_classification__summary
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_financial_pmpm__pmpm_prep
  description: Staging table for financial pmpm object
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_financial_pmpm__pmpm_prep
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_hcc_suspecting__list_rollup
  description: Staging table for hcc suspecting object
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_hcc_suspecting__list_rollup
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_pharmacy__pharmacy_claim_expanded
  description: Staging table for expanded pharmacy claim data
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_pharmacy__pharmacy_claim_expanded
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_quality_measures__summary_long
  description: Staging table for quality measure summary object
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_quality_measures__summary_long
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_readmissions__encounter_augmented
  description: Staging table for readmissions encounter object
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_readmissions__encounter_augmented
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_readmissions__readmission_summary
  description: Staging table for readmissions summary object
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_readmissions__readmission_summary
    tags:
      - semantic_layer
    materialized: ephemeral

- name: semantic_layer__stg_reference_data__calendar
  description: Staging table for calendar object
  config:
    schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_semantic_layer
      {% else %}semantic_layer{%- endif -%}
    alias: semantic_layer__stg_reference_data__calendar
    tags:
      - semantic_layer
    materialized: ephemeral