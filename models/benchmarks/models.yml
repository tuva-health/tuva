version: 2

models:
  - name: benchmarks__person_year
    description: |
        flat table for training ml models on 
    config:
      schema: |
        {%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}{% else %}{%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}
        {% else %}{%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_benchmarks{% else %}benchmarks{%- endif -%}{%- endif -%}{%- endif -%}
      alias: |
        {%- if var('tuva_schema_override',None) != None -%}TUVA_BENCHMARKS_person_year{% else %}person_year{%- endif -%}
      materialized: table
      tags: 
        - benchmarks_train
        - benchmarks
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - person_id
            - payer
            - "{{ '\"plan\"' if (target.type == 'fabric') else 'plan' }}"
            - year_nbr      

  - name: benchmarks__pivot_condition
    description: |
        flat table for training ml models on 
    config:
      schema: |
        {%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}{% else %}{%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}
        {% else %}{%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_benchmarks{% else %}benchmarks{%- endif -%}{%- endif -%}{%- endif -%}
      alias: |
        {%- if var('tuva_schema_override',None) != None -%}TUVA_BENCHMARKS_int_pivot_condition{% else %}int_pivot_condition{%- endif -%}
      materialized: table
      tags: 
        - benchmarks_train
        - benchmarks


  - name: benchmarks__predict_member_month
    description: |
        member_month grain table for data viz with expected values
    config:
      schema: |
        {%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}{% else %}{%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}
        {% else %}{%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_benchmarks{% else %}benchmarks{%- endif -%}{%- endif -%}{%- endif -%}
      alias: |
        {%- if var('tuva_schema_override',None) != None -%}TUVA_BENCHMARKS_predict_member_month{% else %}predict_member_month{%- endif -%}
      materialized: table
      tags: 
        - benchmarks_analysis
        - benchmarks

  - name: benchmarks__predict_inpatient
    description: |
        joining inpatient predicts to encounter table actuals
    config:
      schema: |
        {%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}{% else %}{%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}
        {% else %}{%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_benchmarks{% else %}benchmarks{%- endif -%}{%- endif -%}{%- endif -%}
      alias: |
        {%- if var('tuva_schema_override',None) != None -%}TUVA_BENCHMARKS_predict_inpatient{% else %}predict_inpatient{%- endif -%}
      materialized: table
      tags: 
        - benchmarks_analysis
        - benchmarks
   

  - name: benchmarks__inpatient_input
    description: |
        unpivot for viz
    config:
      schema: |
        {%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}{% else %}{%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}
        {% else %}{%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_benchmarks{% else %}benchmarks{%- endif -%}{%- endif -%}{%- endif -%}
      alias: |
        {%- if var('tuva_schema_override',None) != None -%}TUVA_BENCHMARKS_benchmarks_inpatient_input{% else %}benchmarks_inpatient_input{%- endif -%}
      materialized: table
      tags: 
        - benchmarks_train
        - benchmarks
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - encounter_id             

  - name: benchmarks__unpivot_inpatient
    description: |
        unpivot for viz
    config:
      schema: |
        {%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}{% else %}{%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}
        {% else %}{%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_benchmarks{% else %}benchmarks{%- endif -%}{%- endif -%}{%- endif -%}
      alias: |
        {%- if var('tuva_schema_override',None) != None -%}TUVA_BENCHMARKS_benchmarks_unpivot_inpatient{% else %}benchmarks_unpivot_inpatient{%- endif -%}
      materialized: table
      tags: 
        - benchmarks_analysis
        - benchmarks

  - name: benchmarks__unpivot_member_month
    description: |
        unpivot for viz
    config:
      schema: |
        {%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}{% else %}{%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}
        {% else %}{%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_benchmarks{% else %}benchmarks{%- endif -%}{%- endif -%}{%- endif -%}
      alias: |
        {%- if var('tuva_schema_override',None) != None -%}TUVA_BENCHMARKS_benchmarks_unpivot_member_month{% else %}benchmarks_unpivot_member_month{%- endif -%}
      materialized: table
      tags: 
        - benchmarks_analysis
        - benchmarks


  - name: benchmarks__pivot_hcc
    description: |
        hcc_person_year
    config:
      schema: |
        {%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}{% else %}{%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}
        {% else %}{%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_benchmarks{% else %}benchmarks{%- endif -%}{%- endif -%}{%- endif -%}
      alias: |
        {%- if var('tuva_schema_override',None) != None -%}TUVA_BENCHMARKS_int_pivot_hcc{% else %}int_pivot_hcc{%- endif -%}
      materialized: table
      tags: 
        - benchmarks_train
        - benchmarks

  - name: benchmarks__pivot_cms_condition
    description: |
        hcc_person_year
    config:
      schema: |
        {%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}{% else %}{%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}
        {% else %}{%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_benchmarks{% else %}benchmarks{%- endif -%}{%- endif -%}{%- endif -%}
      alias: |
        {%- if var('tuva_schema_override',None) != None -%}TUVA_BENCHMARKS_int_pivot_cms_condition{% else %}int_pivot_cms_condition{%- endif -%}
      materialized: table
      tags: 
        - benchmarks_train
        - benchmarks

  # Staging models
  - name: benchmarks__stg_core__condition
    description: Staging model for core condition data used in benchmarks
    config:
      materialized: view
      tags: 
        - benchmarks_train
        - benchmarks      
      schema: |
        {%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}{% else %}{%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}
        {% else %}{%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_benchmarks{% else %}benchmarks{%- endif -%}{%- endif -%}{%- endif -%}
      alias: |
        {%- if var('tuva_schema_override',None) != None -%}TUVA_BENCHMARKS__stg_core__condition{% else %}_stg_core__condition{%- endif -%}

  - name: benchmarks__stg_core__member_months
    description: Staging model for core member months data used in benchmarks
    config:
      materialized: view
      tags: 
        - benchmarks_train
        - benchmarks      
      schema: |
        {%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}{% else %}{%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}
        {% else %}{%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_benchmarks{% else %}benchmarks{%- endif -%}{%- endif -%}{%- endif -%}
      alias: |
        {%- if var('tuva_schema_override',None) != None -%}TUVA_BENCHMARKS__stg_core__member_months{% else %}_stg_core__member_months{%- endif -%}

  - name: benchmarks__stg_core__medical_claim
    description: Staging model for core medical claim data used in benchmarks
    config:
      materialized: view
      tags: 
        - benchmarks_train
        - benchmarks      
      schema: |
        {%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}{% else %}{%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}
        {% else %}{%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_benchmarks{% else %}benchmarks{%- endif -%}{%- endif -%}{%- endif -%}
      alias: |
        {%- if var('tuva_schema_override',None) != None -%}TUVA_BENCHMARKS__stg_core__medical_claim{% else %}_stg_core__medical_claim{%- endif -%}

  - name: benchmarks__stg_core__encounter
    description: Staging model for core encounter data used in benchmarks
    config:
      materialized: view
      tags: 
        - benchmarks_train
        - benchmarks      
      schema: |
        {%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}{% else %}{%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}
        {% else %}{%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_benchmarks{% else %}benchmarks{%- endif -%}{%- endif -%}{%- endif -%}
      alias: |
        {%- if var('tuva_schema_override',None) != None -%}TUVA_BENCHMARKS__stg_core__encounter{% else %}_stg_core__encounter{%- endif -%}

  - name: benchmarks__stg_core__patient
    description: Staging model for core patient data used in benchmarks
    config:
      materialized: view
      tags: 
        - benchmarks_train
        - benchmarks      
      schema: |
        {%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}{% else %}{%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}
        {% else %}{%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_benchmarks{% else %}benchmarks{%- endif -%}{%- endif -%}{%- endif -%}
      alias: |
        {%- if var('tuva_schema_override',None) != None -%}TUVA_BENCHMARKS__stg_core__patient{% else %}_stg_core__patient{%- endif -%}

  - name: benchmarks__stg_reference_data__calendar
    description: Staging model for reference calendar data used in benchmarks
    config:
      materialized: view
      tags: 
        - benchmarks_train
        - benchmarks      
      schema: |
        {%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}{% else %}{%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}
        {% else %}{%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_benchmarks{% else %}benchmarks{%- endif -%}{%- endif -%}{%- endif -%}
      alias: |
        {%- if var('tuva_schema_override',None) != None -%}TUVA_BENCHMARKS__stg_reference_data__calendar{% else %}_stg_reference_data__calendar{%- endif -%}

  - name: benchmarks__stg_cms_hcc__int_disease_factors
    description: Staging model for CMS HCC disease factors data used in benchmarks
    config:
      materialized: view
      tags: 
        - benchmarks_train
        - benchmarks      
      schema: |
        {%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}{% else %}{%- if var('tuva_schema_override',None) != None -%}{{var('tuva_schema_override')}}
        {% else %}{%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_benchmarks{% else %}benchmarks{%- endif -%}{%- endif -%}{%- endif -%}
      alias: |
        {%- if var('tuva_schema_override',None) != None -%}TUVA_BENCHMARKS__stg_cms_hcc__int_disease_factors{% else %}_stg_cms_hcc__int_disease_factors{%- endif -%}