name: 'the_tuva_project'
version: '0.15.4'
config-version: 2
require-dbt-version: ">=1.9.0"

profile: default

models:
  ## see docs: https://docs.elementary-data.com/
  elementary:
    ## elementary models will be created in the schema '<your_schema>_elementary'
    +schema: |
      {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_elementary{% else %}elementary{%- endif -%}
    ## To disable elementary for dev, uncomment this:
    # enabled: "{{ target.name in ['prod','analytics'] }}"

flags:
  require_explicit_package_overrides_for_builtin_materializations: false # Needed for Elementary

vars:
    clinical_enabled: true
    claims_enabled: true
    provider_attribution_enabled: true
    use_synthetic_data: false
    input_database: dev_ci_testing
    input_schema: input_layer
    ## CCSR data mart vars
    # Set to "ip" for inpatient data or "op" for outpatient data (More info in the README)
    record_type: "ip"

    # CCSR Version numbers from HCUP
    dxccsr_version: "'2023.1'"
    prccsr_version: "'2023.1'"

    ## CMS HCC data mart vars
    # The payment_year variable has a default of the current year, this can be
    # changed by adding the numeric value of a year (ex: cms_hcc_payment_year: 2019)
    cms_hcc_payment_year: '{{ run_started_at.strftime("%Y") }}'

    ## Quality Measures period var
    # to run quality measueres for a period other than current year, add the below variable uncommented to your project
    #quality_measures_period_end: "2020-12-31"

    ## Enable Normalize engine var
    # set to false or leave undefined to affect no change
    # set to unmapped to enable models in normalize schema that list any codes not mapped to normalized codes
    # set to true produce the unmapped code models, and to integrate a seed called custom_mapped to map codes to normalized
    # enable_normalize_engine: false

    ## Tuva Last Run
    # The date and timestamp of the dbt run that will populate the tuva_last_run column in all models.
    # Default timezone is UTC
    tuva_last_run: '{{ run_started_at.astimezone(modules.pytz.timezone("UTC")) }}'

    ## Tuva seed S3 bucket override (for PG only) - also optional prefix in case the bucket has other content
    #tuva_seeds_s3_bucket: "tuva-public-resources"
    #tuva_seeds_s3_key_prefix: "tuva/seeds/example/prefix"
    custom_bucket_name: tuva-public-resources

    ## DQI data testing on input layer
    enable_input_layer_testing: true

    ## Set this variable to true if you want legacy data quality models to build
    enable_legacy_data_quality: false

    # Enable groups of marts
    # clinical_enabled: true
    # claims_enabled: true

    # Enable specific marts
    # ccsr_enabled: false
    # claims_preprocessing_enabled: false
    # cms_chronic_conditions_enabled: false
    # cms_hcc_enabled: false
    # ed_classification_enabled: false
    # fhir_preprocessing_enabled: true # defaults to false
    # financial_pmpm_enabled: false
    # hedis_enabled: true # defaults to false
    # insights_enabled: false
    # quality_measures_enabled: false
    # readmissions_enabled: true
    # tuva_chronic_conditions_enabled: false
    # provider_attribution: false

    
on-run-start:
  - "{{ log_invocation_start() }}"
on-run-end:
  - "{{ log_warning_for_seeds() }}"

model-paths: ["models"]
analysis-paths: ["analyses"]
test-paths: ["tests"]
seed-paths: ["seeds"]
macro-paths: ["macros"]
snapshot-paths: ["snapshots"]
docs-paths: ["dbt_doc_blocks"]
target-path: "target"
clean-targets:
    - "target"
    - "dbt_packages"

